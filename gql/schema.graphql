schema {
  query: RootQuery
  subscription: RootSubscription
  mutation: RootMutation
}

"""
The `Time` scalar type represents a DateTime. The DateTime is serialized as an RFC 3339 quoted string
"""
scalar Time

type Deal {
  ID: ID!
  ClientAddress: String!
  ProviderAddress: String!
  CreatedAt: Time!
  PieceCid: String!
  PieceSize: Float!
  ProviderCollateral: Float!
  StartEpoch: Float!
  EndEpoch: Float!
  Message: String!
  Logs: [DealLog]!
}

type DealList {
  totalCount: Int!
  next: ID
  deals: [Deal]!
}

type DealLog {
  DealUUID: ID!
  CreatedAt: Time!
  Text: String!
}

type Storage {
  Completed: Float!
  Transferring: Float!
  Pending: Float!
  Free: Float!
  MountPoint: String!
}

type FundsEscrow {
  Available: Float!
  Locked: Float!
  Tagged: Float!
}

type FundsWallet {
  Address: String!
  Balance: Float!
  Tagged: Float!
}

type Funds {
  Escrow: FundsEscrow!
  Collateral: FundsWallet!
  PubMsg: FundsWallet!
}

type FundsLogList {
  totalCount: Int!
  logs: [FundsLog]!
  next: Time
}

type FundsLog {
  DealUUID: ID!
  CreatedAt: Time!
  Amount: Float!
  Text: String!
}

type DealPublish {
  Period: Int!
  Start: Time!
  MaxDealsPerMsg: Int!
  Deals: [Deal]!
}

type TransferPoint {
  At: Time!
  Bytes: Float!
}

type MpoolMessage {
  From: String!
  To: String!
  Nonce: Float!
  Value: Float!
  GasFeeCap: Float!
  GasLimit: Float!
  GasPremium: Float!
  Method: String!
  Params: String!
  BaseFee: Float!
}

type RootQuery {
  """Get Deal by ID"""
  deal(id: ID!): Deal

  """Get all Deals"""
  deals(first: ID, limit: Int): DealList!

  """Get storage space usage"""
  storage: Storage!

  """Get funds available"""
  funds: Funds!

  """Get log of fund transactions"""
  fundsLogs: FundsLogList!

  """Get information about deals that are pending being published"""
  dealPublish: DealPublish!

  """Get ongoing transfers"""
  transfers: [TransferPoint]!

  """Get local messages in the mpool"""
  mpool(local: Boolean!): [MpoolMessage]!
}

type RootMutation {
  """Cancel a Deal"""
  dealCancel(id: ID!): ID!

  """Publish all pending deals now"""
  dealPublishNow: Boolean!

  """Top-up the available pledge collateral in escrow for deal publishing"""
  fundsMoveToEscrow(amount: Float!): Boolean!
}

type RootSubscription {
  """Subscribe to Deal updates by ID"""
  dealUpdate(id: ID!): Deal
  """Subscribe to new Deals"""
  dealNew: Deal
}
